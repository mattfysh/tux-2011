<?xml version="1.0"?>
<project name="tux" default="build" basedir="../">
	
	<property name="jshint.flags" value="maxerr=25,undef=true,curly=true,debug=true,eqeqeq=true,immed=true,newcap=true,onevar=true,plusplus=true,strict=true" />
	<property name="jshint.predef" value="predef=namespace;noop;tux;Backbone;Store;_" />
	<property name="jshint.predef.test" value="${jshint.predef};describe;it;beforeEach;expect;sinon" />
	
	<property name="jshint.fullopt" value="${jshint.flags},${jshint.predef}" />
	<property name="jshint.fullopt.test" value="${jshint.flags},${jshint.predef.test}" />

	<target name="build">
		<antcall target="lint-src" />
		<antcall target="lint-tests" />
		<antcall target="test" />
	</target>

	<!-- lint source -->
	<target name="lint-src">
		<antcall target="lint">
			<param name="dir" value="src" />
			<param name="opt" value="${jshint.fullopt}" />
		</antcall>
	</target>

	<!-- lint tests -->
	<target name="lint-tests">
		<antcall target="lint">
			<param name="dir" value="test" />
			<param name="opt" value="${jshint.fullopt.test}" />
		</antcall>
	</target>

	<!-- lint -->
	<target name="lint">
		<apply dir="build" executable="java" failonerror="true">
			<fileset dir="${dir}" includes="**/*.js" />
			<arg line="-jar rhino.jar jshint-rhino.js" />
			<srcfile />
			<arg value="${opt}" />
		</apply>
		<echo>${dir} JSHint Passed</echo>
	</target>

	<!-- run unit tests -->
	<target name="test">
		<exec executable="java" failonerror="true">
			<arg line="-jar build/JsTestDriver-1.3.2.jar --reset --tests all" />
		</exec>
		<echo>Jasmine Specs Passed</echo>
	</target>

</project>